<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login and Registration Form</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script async defer src="https://apis.google.com/js/api:client.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/cc3f5e14e0.js"></script>
    <link rel="stylesheet" href="login-style.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card">
                    <div class="card-body">
                        <h1 class="card-title text-center fw-bold" id="title">Sign Up</h1>
                        <form id="signup-form" method="post" action="/signup">
                            <div class="input-group mb-3" id="nameField">
                                <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
                                <input type="text" class="form-control" name="name" placeholder="Name">
                            </div>
    
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa-solid fa-envelope"></i></span>
                                <input type="email" class="form-control" name="email" placeholder="Email">
                            </div>
    
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
                                <input type="password" class="form-control" name="password" placeholder="Password">
                            </div>
    
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary" id="signupBtn">Sign Up</button>
                            </div>
                        </form>
    
                        <form id="signin-form" method="post" action="/login" style="display:none;">
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa-solid fa-envelope"></i></span>
                                <input type="email" class="form-control" name="email" placeholder="Email">
                            </div>
    
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
                                <input type="password" class="form-control" name="password" placeholder="Password">
                            </div>
    
                            <p class="text-center">Lost password <a href="#">Click Here</a></p>
    
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary" id="signinBtn">Sign Up</button>
                            </div>
                        </form>
                        <button class="btn btn-secondary w-100 mt-2" id="toggle-form">Switch to Sign In</button>
                        <p class="text-center mt-3">Or continue with:</p>
    
                        <div class="d-flex justify-content-center mb-3">
                            <button class="btn btn-primary mx-2"><i class="fab fa-facebook custom-fb" onclick="signInWithGoogle()"></i></i> Facebook</button>
                            <button class="btn btn-primary google-btn" onclick="signInWithGoogle()">
                                <i class="fab fa-google custom-google me-2"></i>Google
                              </button>
                        </div>
    
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <script async defer src="https://apis.google.com/js/api:client.js"></script>

    <script>
           const nameField = document.getElementById('nameField');
const nameInput = document.querySelector('input[name="name"]');
const emailInput = document.querySelector('input[name="email"]');
const passwordInput = document.querySelector('input[name="password"]');

// Input sanitization functions
function sanitizeInput(input) {
    return input.trim();
}

function sanitizeHtml(value) {
    return sanitizeHtml(value, {
        allowedTags: [],
        allowedAttributes: {},
    });
}

// Input validation functions
function validateEmail(email) {
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
}

function validatePassword(password) {
    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return regex.test(password);
}

// Sign Up form submission
document.getElementById('signup-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const name = sanitizeInput(nameInput.value);
    const email = sanitizeInput(emailInput.value);
    const password = sanitizeInput(passwordInput.value);

    if (!name || !email || !password) {
        alert('Please fill out all the fields.');
        return;
    }

    if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
    }

    if (!validatePassword(password)) {
        alert('Please enter a valid password. Your password must contain at least 8 characters, including one uppercase letter, one lowercase letter, one number, and one special character.');
        return;
    }

    const response = await fetch('/signup', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`,
    });

    if (response.status === 201) {
        alert('User created successfully');
    } else {
        alert('An error occurred while signing up');
    }
});

// Login form submission
document.getElementById('signin-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const email = sanitizeInput(emailInput.value);
    const password = sanitizeInput(passwordInput.value);

    if (!email || !password) {
        alert('Please fill out all the fields.');
        return;
    }

    if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
    }

    const response = await fetch('/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`,
    });

    if (response.status === 200) {
        window.location.href = '/dashboard.html';
    } else {
        alert('Invalid email or password');
    }
});

// Toggle form between Sign Up and Sign In
document.getElementById('toggle-form').addEventListener('click', function(event) {
    event.preventDefault();

    const title = document.getElementById('title');
    const signupForm = document.getElementById('signup-form');
    const signinForm = document.getElementById('signin-form');
    const signupBtn = document.getElementById('signupBtn');
    const signinBtn = document.getElementById('signinBtn');

    if (title.textContent === 'Sign Up') {
        title.textContent = 'Sign In';
        signupForm.style.display = 'none';
        signinForm.style.display = 'block';
        signupBtn.classList.remove('btn-primary');
        signupBtn.classList.add('btn-light');
        signinBtn.classList.remove('btn-light');
        signinBtn.classList.add('btn-primary');
    } else {
        title.textContent = 'Sign Up';
        signupForm.style.display = 'block';
        signinForm.style.display = 'none';
        signupBtn.classList.remove('btn-light');
        signupBtn.classList.add('btn-primary');
        signinBtn.classList.remove('btn-primary');
        signinBtn.classList.add('btn-light');
    }
});

    </script>
</body>
</html>
